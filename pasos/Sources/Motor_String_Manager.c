/*! **************************
*
* @file: Motor_String_Manager.c
* @author(s): Daniela Becerra, Jes√∫s Barroso
*
* @brief
* 8 sequences of 8 bits, with the 4 least significant are the ones that
* determine the movement of a step motor with a half step sequences
* These 8 sequences are located in an array, and by traversing it
* in one way or another, the motor will turn on.
*
************************** */

/*************************************************************************************************/
/*********************						Includes						**********************/
/*************************************************************************************************/
#include "HAL\GPIO.h"
#include "hHIL\MotorStringManager.h"

*************************************************************************************************/
/*********************						Defines							**********************/
/*************************************************************************************************/

//sequences of 4 BITS alternating to run a step motor
#define S0 8
#define S1 12
#define S2 4
#define S3 6
#define S4 2
#define S5 3
#define S6 1
#define S7 9
#define S_INDEX 0 //sequence index
#define BITS 8
#define MAX_BIT 7
#define MIN_BIT 0

/*************************************************************************************************/
/*********************						Typedefs						**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************					Function Prototypes					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Static Variables                    **********************/
/*************************************************************************************************/
u8 half_step_sequence[] = {S0, S1, S2, S3, S4, S5, S6, S7};
u8 u8current_sequence; //the current value on the port

/*************************************************************************************************/
/*********************					Global Variables					**********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Static Constants                    **********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************                  Global Constants                    **********************/
/*************************************************************************************************/

/*************************************************************************************************/
/*********************				   Exported Functions					**********************/
/*************************************************************************************************/

void MotorStringManager_Init(void)
{
	GPIO_CONFIG_PORT_OUT(MOTOR_STRING_PORT, MOTOR_STRING_PIN_START, MOTOR_STRING_NUMBER_OF_PINS);
}

//-------------------------------------------------------------------------------------------------
void MotorStringManager_RotateClockwise(void)
{
  S_INDEX++;
  u8current_sequence = half_step_sequence[S_INDEX % BITS];
  GPIO_WRITE_PORT(MOTOR_STRING_PORT, u8current_sequence);
}

//-------------------------------------------------------------------------------------------------
void MotorStringManager_RotateCounterClockwise(void)
{
	S_INDEX--;
  u8current_sequence = half_step_sequence[S_INDEX % BITS];
  GPIO_WRITE_PORT(MOTOR_STRING_PORT, u8current_sequence);
}
